<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Scratchlet – Login</title>
<link rel="shortcut icon" href="https://i.postimg.cc/Wbsrt82t/Scratchlet-Icon.png">
<link href="https://fonts.googleapis.com/css2?family=Titan+One&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body {
    font-family: "Nunito", sans-serif;
    background:
        linear-gradient(rgba(210,180,140,.15) 1px, transparent 1px),
        linear-gradient(90deg, rgba(210,180,140,.15) 1px, transparent 1px),
        linear-gradient(135deg,#FF8C00,#FFA500);
    background-size:40px 40px;
    margin:0;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    color:white;
}
.login-container{
    width:400px;
    padding:40px;
    background:rgba(255,255,255,.15);
    backdrop-filter:blur(10px);
    border-radius:20px;
    border:2px solid rgba(255,255,255,.2);
    box-shadow:0 15px 35px rgba(0,0,0,.2);
    text-align:center;
    display:flex;
    flex-direction: column;
    align-items: center;
}
h1{
    font-family:"Titan One",sans-serif;
    font-size:2.8em;
    margin-bottom:30px;
}
.input-group{
    width:100%;
    max-width:320px;
    margin-bottom:20px;
}
label{
    font-weight:600; 
    display:block; 
    margin-bottom:5px;
}
input{
    width:100%;
    padding:14px 16px;
    border-radius:10px;
    border:2px solid rgba(255,255,255,.3);
    background:rgba(255,255,255,.1);
    color:white;
    font-size:16px;
    font-family:"Nunito",sans-serif;
    box-sizing:border-box;
    transition:0.3s;
}
input:focus{
    outline:none;
    border-color:white;
    background:rgba(255,255,255,.15);
}

/* Toggle below password */
.show-password-toggle{
    display:block;
    text-align:center;
    margin-top:8px;
    cursor:pointer;
    font-size:0.9em;
    font-weight:600;
    color:#FFA500;
    padding:4px 8px;
    border-radius:6px;
    background:rgba(255,255,255,0.2);
    transition:0.2s;
    user-select:none;
    width:fit-content;
    margin-left:auto;
    margin-right:auto;
}
.show-password-toggle:hover{
    background:rgba(255,255,255,0.35);
    color:#FF8C00;
}

/* ✅ Full-width login button */
.login-button{
    width:100%;          /* full width of container */
    padding:15px;
    border-radius:25px;
    border:none;
    background:white;
    color:#FF8C00;
    font-weight:700;
    font-size:1.1em;
    cursor:pointer;
    margin-top:10px;
    transition: all 0.3s ease; /* smooth hover */
}
.login-button:hover{
    transform:translateY(-2px);
    box-shadow:0 6px 20px rgba(0,0,0,0.3);
}

.links{margin-top:18px;font-size:.95em; text-align:center;}
.links a{color:white;font-weight:600;text-decoration:none;}
.links a:hover{text-decoration:underline;}

.bot-login{
    margin-top:20px;
    padding:12px;
    background:rgba(255,255,255,.1);
    border-radius:10px;
}
.bot-login a{color:#FFD700;font-weight:700;}
</style>
</head>

<body>
<div class="login-container">
<h1>Welcome Back!</h1>

<form id="loginForm">
    <div class="input-group">
        <label>Email or Username</label>
        <input id="email" placeholder="Email or username" required>
    </div>

    <div class="input-group">
        <label>Password</label>
        <input type="password" id="password" placeholder="Password" required>
        <span class="show-password-toggle" id="togglePassword">Show</span>
    </div>

    <button class="login-button" type="submit">LOGIN</button>
</form>

<div class="links">
    <a href="#" id="resetPasswordLink">Forgot password?</a><br><br>
    New to Scratchlet? <a href="https://scratchlet.github.io/register">Create Account</a>
</div>

<div class="bot-login">
    <a href="https://scratchlet-app.neocities.org/bot-login">Bot Account Login</a>
</div>

<div class="links">
    <a href="https://scratchlet.github.io/site">← Back to Landing Page</a>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import {
    getAuth,
    signInWithEmailAndPassword,
    createUserWithEmailAndPassword,
    sendPasswordResetEmail,
    getIdTokenResult
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-analytics.js";


const firebaseConfig = {
  apiKey: "AIzaSyAaldT-No13P7AADP9C8kvB2ALKSXqFaoo",
  authDomain: "scratchlet-3d6b9.firebaseapp.com",
  projectId: "scratchlet-3d6b9",
  storageBucket: "scratchlet-3d6b9.firebasestorage.app",
  messagingSenderId: "951209105844",
  appId: "1:951209105844:web:20658ab98fb99d6d137ae1",
  measurementId: "G-7KG8097XYB"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
getAnalytics(app);


document.getElementById("loginForm").addEventListener("submit", async (e)=>{
    e.preventDefault();
    const identifier = email.value.trim();
    const password = document.getElementById("password").value;


    if(identifier==="scratchlet" && password==="botpassword123"){
        localStorage.setItem("isLoggedIn","true");
        localStorage.setItem("userRole","bot");
        localStorage.setItem("username","scratchlet");
        location.href="https://scratchlet-app.neocities.org/bot-panel";
        return;
    }

    const emailAddr = identifier.includes("@") ? identifier : `${identifier}@scratchlet.local`;

    try{
        await signInWithEmailAndPassword(auth,emailAddr,password);
        const user = auth.currentUser;
        const token = await getIdTokenResult(user);
        const role = token.claims.role || "user";

        localStorage.setItem("isLoggedIn","true");
        localStorage.setItem("userRole",role);
        localStorage.setItem("username",emailAddr.split("@")[0]);

        location.href="https://scratchlet.github.io/home";
        return;
    }catch{}

 
    const users = JSON.parse(localStorage.getItem("scratchletUsers")||"[]");
    const legacy = users.find(
        u=>(u.username===identifier||u.email===identifier)&&u.password===password
    );

    if(!legacy){alert("Invalid login details");return;}

    try{
        await createUserWithEmailAndPassword(auth,emailAddr,password);
        localStorage.setItem("isLoggedIn","true");
        localStorage.setItem("userRole",legacy.role||"user");
        localStorage.setItem("username",legacy.username);
        location.href="https://scratchlet.github.io/home";
    }catch{
        alert("Login failed");
    }
});


resetPasswordLink.onclick = async e=>{
    e.preventDefault();
    const id=email.value.trim();
    if(!id){alert("Enter email or username first");return;}
    const addr=id.includes("@")?id:`${id}@scratchlet.local`;
    try{await sendPasswordResetEmail(auth,addr); alert("Password reset email sent!");}
    catch{alert("Reset failed");}
};


const togglePassword = document.getElementById("togglePassword");
const passwordField = document.getElementById("password");
togglePassword.addEventListener("click", ()=>{
    if(passwordField.type==="password"){
        passwordField.type="text";
        togglePassword.textContent="Hide";
    }else{
        passwordField.type="password";
        togglePassword.textContent="Show";
    }
});
</script>
</body>
</html>
